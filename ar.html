<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AR Sketch Projector</title>

<style>
:root {
  --glass: rgba(20,20,20,.65);
  --border: rgba(255,255,255,.15);
  --accent: #4cffc0;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: black;
  overflow: hidden;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

/* Camera */
#camera {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Overlay */
#overlay-container {
  position: fixed;
  inset: 0;
  pointer-events: none;
}

#overlay-img {
  position: absolute;
  top: 50%;
  left: 50%;
  transform-origin: center;
  max-width: 70vw;
  opacity: .6;
  pointer-events: auto;
  touch-action: none;
  cursor: grab;
  user-select: none;
}

/* Toolbar */
.toolbar {
  position: fixed;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  padding: 10px 14px;
  background: var(--glass);
  border: 1px solid var(--border);
  border-radius: 18px;
  backdrop-filter: blur(12px);
  z-index: 10;
}

.toolbar button,
.toolbar input[type=file] {
  background: transparent;
  color: white;
  border: 1px solid var(--border);
  padding: 8px 12px;
  border-radius: 12px;
  cursor: pointer;
}

.toolbar button:hover {
  border-color: var(--accent);
  color: var(--accent);
}

/* Bottom Controls */
.controls {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  width: min(95%, 420px);
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  padding: 14px;
  background: var(--glass);
  border-radius: 20px;
  border: 1px solid var(--border);
  backdrop-filter: blur(12px);
}

.controls label {
  color: #aaa;
  font-size: 13px;
}

.controls input[type=range] {
  flex: 1;
}

.controls button {
  background: transparent;
  color: white;
  border: 1px solid var(--border);
  padding: 8px 14px;
  border-radius: 12px;
  cursor: pointer;
}

.controls button:hover {
  border-color: var(--accent);
}

/* Mobile */
@media(max-width:600px) {
  .toolbar {
    width: 95%;
    justify-content: space-between;
  }
}
</style>
</head>

<body>

<video id="camera" autoplay playsinline></video>

<div id="overlay-container">
  <img id="overlay-img">
</div>

<!-- TOP BAR -->
<div class="toolbar">
  <input type="file" id="upload" accept="image/*">
  <button id="lock">Lock</button>
</div>

<!-- BOTTOM PANEL -->
<div class="controls">
  <label>Opacity</label>
  <input type="range" min="0.1" max="1" step="0.05" value="0.6" id="opacity">
  <button id="rotate">Rotate</button>
  <button id="reset">Reset</button>
</div>

<script>
const video = document.getElementById("camera");
const overlay = document.getElementById("overlay-img");

const upload = document.getElementById("upload");
const opacity = document.getElementById("opacity");
const rotateBtn = document.getElementById("rotate");
const lockBtn = document.getElementById("lock");
const resetBtn = document.getElementById("reset");

let scale = 1;
let rotation = 0;
let locked = false;
let posX = innerWidth/2;
let posY = innerHeight/2;

// Camera
navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" }
}).then(s => video.srcObject = s);

// Upload
upload.onchange = e => {
  const file = e.target.files[0];
  overlay.src = URL.createObjectURL(file);
};

// Opacity
opacity.oninput = e => overlay.style.opacity = e.target.value;

// Rotate button
rotateBtn.onclick = () => {
  rotation += 10;
  update();
};

// Lock
lockBtn.onclick = () => {
  locked = !locked;
  overlay.style.pointerEvents = locked ? "none" : "auto";
  lockBtn.textContent = locked ? "Unlock" : "Lock";
};

// Reset
resetBtn.onclick = () => {
  scale = 1;
  rotation = 0;
  posX = innerWidth/2;
  posY = innerHeight/2;
  update();
};

// Update transform
function update() {
  overlay.style.transform =
   `translate(${posX}px,${posY}px) translate(-50%,-50%) scale(${scale}) rotate(${rotation}deg)`;
}

// =====================
// TOUCH + DRAG SUPPORT
// =====================

let pointers = new Map();
let startDist = 0;
let startScale = 1;
let startAngle = 0;
let startRotation = 0;

overlay.addEventListener("pointerdown", e => {
  if (locked) return;
  pointers.set(e.pointerId, e);
  overlay.setPointerCapture(e.pointerId);
});

overlay.addEventListener("pointermove", e => {
  if (!pointers.has(e.pointerId) || locked) return;

  pointers.set(e.pointerId, e);

  if (pointers.size === 1) {
    // drag
    const p = [...pointers.values()][0];
    posX += e.movementX;
    posY += e.movementY;
    update();
  }

  if (pointers.size === 2) {
    const [a,b] = [...pointers.values()];

    const dx = b.clientX - a.clientX;
    const dy = b.clientY - a.clientY;

    const dist = Math.hypot(dx,dy);
    const angle = Math.atan2(dy,dx) * 180/Math.PI;

    if (!startDist) {
      startDist = dist;
      startScale = scale;
      startAngle = angle;
      startRotation = rotation;
    } else {
      scale = startScale * (dist / startDist);
      rotation = startRotation + (angle - startAngle);
      update();
    }
  }
});

overlay.addEventListener("pointerup", resetPointers);
overlay.addEventListener("pointercancel", resetPointers);

function resetPointers(e){
  pointers.delete(e.pointerId);
  if (pointers.size < 2) startDist = 0;
}

// Mouse wheel zoom
window.addEventListener("wheel", e=>{
  scale += e.deltaY * -0.001;
  scale = Math.min(Math.max(.1,scale),5);
  update();
});
</script>

</body>
</html>
